# Протокол HTTP

## Основное

### 1. Введение

Как вы знаете, сайты размещаются в интернете и для просмотров страниц этих сайтов нужна специальная программа - браузер.

Технически сайты размещаются на специальных компьютерах, которые подключены к интернету. Такие компьютеры называются серверами. Как правило, чтобы разместить сайт в интернете автор сайта покупает место на сервере у специальной организации, которая называется хостингом.

Браузер может получать страницы сайтов с серверов, расположенных в интернете. В рамках взаимодействия браузера и сервера браузер обычно называют клиентом.

Существуют специальные правила, регламентирующие общение клиента и сервера. Набор таких правил называется протоколом. Основным протоколом при работе сайта является протокол HTTP. Этот протокол мы будем изучать в рамках данного учебника.

### 2. Запросы и ответы

Пусть пользователь хочет открыть в браузере некоторую страницу некоторого сайта. Для этого пользователь либо переходит по некоторой ссылки, либо вбивает URL страницы в адресную строку браузера. При этом оба технически эквиваленты.

После этого браузер отправляет серверу запрос (request), в котором просит сервер отдать страницу по указанному URL. Сервер получает запрос браузера, формирует ответ (response) и отправляет его обратно в браузер. Правила оформления этих строк и регулирует протокол HTTP.

Таким образом все взаимодействия клиента и сервера сводится к перебрасыванию сообщений, подобно мячикам в пинг-понге.

При этом инициация запроса обязательна. Это значит, что сервер всегда шлёт ответ на запрос браузера. Не может быть такого, что сервер что-то пошлёт браузеру сам, без предваряющего запроса браузера.

### 3. Отсутствие состояния

Протокол HTTP не содержит прямой возможности сделать так, чтобы сервер нас запомнил. Это значит, когда вы видите в браузере загруженную страницу, в этот момент сервер уже давно обработал ваш запрос, сразу же забыв про вас.

При этом при получении запросов сервер не может отличить, отправлены ли эти запросы одним клиентом или разными. То есть перемещаясь по страницам сайта при открытии каждой новой страницы сервер не знает, совершали ли мы какие-либо действия на сайте или ещё нет.

В реальной жизни, как вы знаете, из личного опыта, сайты запоминают нас. Мы можем авторизироваться на сайте, складывать товары в интернет-магазине и так далее. Это делается с помощью специальных обходных путей, позволяющих серверу различать клиентов. Эти пути мы и будем изучать в дальнейшем.

### 4. Структура HTTP сообщения

Итак, клиент и сервер обмениваются друг с другом сообщениями, оформленными специальным образом. Давайте рассмотрим структуру этих сообщений.

Каждое HTTP-сообщение состоит из трёх частей, которые передаются в указанном порядке:

1. Стартовая строка (starting line)
2. Заголовки (headers)
3. Тело сообщения (message body)

Технически стартовая строка является первой строкой сообщения, затем на каждой строке размещается по одному заголовку, затем идёт пустая строка и после неё размещается тело запроса.

При этом стартовая строка определяет тип сообщения, заголовки характеризуют тело сообщения, параметры передачи и прочие сведения, а тело содержит непосредственно данные сообщения.

Стартовая строка и заголовки являются обязательными элементами, а тело - нет. При этом стартовые строки различаются для запроса и ответа.

В следующих уроках мы отдельно разберём каждую часть HTTP-сообщения.

### 5. Стартовая строка HTTP-запроса

Строка запроса состоит из следующих частей, разделённых пробелом: из метода запроса, URI запрошенной страницы, версии протокола HTTP.

Метод запроса указывает, хотим ли мы что-нибудь с сервера или наоборот, что-то передать на сервер. Как правило, используются два метода - GET - для получения и POST - для отправки данных.

URI запрошенной страницы содержит адрес страницы, которую хочет получить браузер. URI отличается от URL тем, что не содержит имени домена (оно в протоколе HTTP передаётся отдельно).

Версия протокола указывается следующим образом: сначала буквы HTTP, потом слэш, а потом собственно версия.

Давайте напишем пример стартовой строки HTTP-запроса для получения страницы:

```
GET /page/test HTTP/1.1
```

А теперь пример запроса для отправки данных:

```
POST /page/test HTTP/1.1
```

### 6. Методы HTTP-запросов

Самыми частыми методами HTTP-запросов являются методы `GET` и `POST`. Давайте рассмотрим эти методы подробнее, а также изучим другие, более редкие методы. Описание других методов будет достаточно общее. Дело в том, что эти методы имеют широкое применение и протокол HTTP указывает лишь их общее предназначение. Итак, вот описание методов.

#### GET

Метод GET - основной метод, используемый чаще всего. Он применяется для простого получения страниц.

#### POST

Метод POST применяется для передачи пользовательских данных. Например, посетитель сайта хочет отправить комментарий к статье. В этом случае клиент должен осуществить запрос методом POST. При этом комментарий пользователя будет отправлен в теле запроса. А сервер сохранит этот комментарий и в ответ даст страницу этой статьи, в которую будут все оставленные ранее комментарии и наш новый. Также с помощью метода POST обычно загружаются файлы на сервер.

#### HEAD

Метод HEAD запрашивает страницу так же как и метод GET, но в ответ получает только заголовки, без тела ответа.

#### DELETE

Метод DELETE явно указывает серверу, что клиент хочет удалить данные, хранящиеся на сервере для данного URI.

#### PATCH

Метод PATCH явно указывает серверу, что клиент хочет изменить данные, хранящиеся на сервере для данного URI.

#### PUT

Метод PUT явно указывает серверу, что клиент хочет загрузить данные на сервере для данного URI.

Фундаментальное различие методов `POST` и `PUT` заключается в понимании предназначений указанный URI. Метод `POST` предполагает, что по указанному URI будет передаваться обработка передаваемого клиентом содержимого. Используя `PUT` клиент предполагает, что загружаемое содержимое соответствует находящемуся по заданному URI адресу.

#### Реальная жизнь

В реальной жизни сервера хорошо поддерживают только методы `GET` и `POST`. Поэтому метод `GET` используется как для получения данных, так для их удаления и изменения. А метод `POST` используется как для загрузки данных, так и для изменения данных и их удаления.

### 7. Стартовая строка HTTP ответа

Строка ответа состоит из следующих частей, разделённых пробелом: версии протокола HTTP, кода состояния и пояснения состояния.

Код состояния (status code) указывает был ли успешен запрос или случилась ошибка. Этот код состоит из трёх цифр. Для примера код `200` символизирует успех, а код `404` указывает клиенту, что страница по данному URL не найдена.

Пояснение состояния (reason phrase) представляет собой короткий текст описывающий код состояния. Оно предназначено для чтения человеком и никак не влияет на сообщение и не является обязательным. Например, для кода `404` пояснением будет `Not Found` (не найдено).

Давайте напишем пример стартовой строки HTTP ответа для успеха:

`HTTP/1.1 200 OK`

А теперь пример ответа ошибки

`HTTP/1.1 404 Not Found`

### 8. Группы кодов состояний HTTP-запросов

Коды состояний ответа сгруппированы в зависимости от результата. При этом группа определяется первой цифрой номера кода. Давайте изучим группы:

#### 1xx

Коды, начинающиеся на 1, представляет собой информационные сообщения от сервера о процессе передачи данных

#### 2xx

Коды, начинающиеся на 2, представляют собой сообщения об успехе.

#### 3xx

Коды, начинающиеся на 3, сообщают клиенту, что для успешного выполнения операции необходимо сделать другой запрос по другому URI. То есть сервер таким кодом ответа заставляет браузер выполнять редирект на другой адрес.

#### 4xxx

Коды, начинающиеся на 4, сообщают, что на сервере произошла ошибка по вине клиента.

#### 5xxx

Коды, начинающиеся на 5, сообщают, что на сервере, произошла по вине сервера.

#### Задача 1

Изучите полный список кодов.

всего 63 ответа

#### Задача 2

Расскажите, что делает код 200.

`200 OK` - Стандартный ответ для успешных HTTP-запросов

#### Задача 3

Расскажите, что делает код 201.

`201 Created` - Запрос успешно выполнен и в результате был создан новый ресурс (часто после POST)

#### Задача 4

Расскажите, что делает код 204.
`204 No Content` - Сервер успешно обработал запрос, но не возвращает никакого содержимого.

#### Задача 5

Расскажите, что делает код 404.

`404 Not Found` - Сервер не может найти запрошенный ресурс

#### Задача 6

Расскажите, что делает код 405.

`405 Method Not Allowed` - Метод запроса (GET, POST и т.д.) не поддерживается для данного URL

#### Задача 7

Расскажите, что делает код 301.

`301 Moved Permanently` - Запрошенный ресурс был навсегда перемещён по новому URL

#### Задача 8

Расскажите, что делает код 302.

`302 Found` - Запрошенный ресурс был временно перемещён по новому URL

#### Задача 9

Расскажите, что делает код 501.

`501 Not Implemented` - Сервер не поддерживает функциональность, необходимую для выполнения запроса.

### 9. HTTP заголовки

После стартовой строки передаются HTTP-заголовки. Заголовки делают дополнительные параметры HTTP-сообщения. Технически каждый заголовок должен начинаться с новой строки. Технически каждый заголовок должен начинаться с новой строки. А когда все заголовки перечислены, должна следовать пустая строка и тело HTTP-строка.

Каждый заголовок состоит из имени и значения. Они разделяются двоеточием. Давайте посмотрим на примеры заголовков

```
Content-Type: text/html; charset=utf-8
Content-Language: ru
Last-Modified: Sat, 16, Jan 2020
    21:16:42 GMT
```

### 10. Группы HTTP-заголовков

Все заголовки разделяются на четыре основные группы:

1. General Headers (общие заголовки)
2. Request Headers (заголовки запросы)
3. Response Headers (заголовки ответа)
4. Entity Headers (заголовки сущности)

#### Общие заголовки

Общие заголовки применяются как к запросам, так и ответам, но не имеют отношения к данным, переданным в теле.

#### Заголовки запроса

Заголовки запроса содержат больше информации о ресурсе, который нужно получить, или о клиенте, запрашивающем ресурс.

#### Заголовки ответа

Заголовки ответ содержат дополнительную информацию об ответе, например, его местонахождение, или о сервере, предоставившем его.

#### Заголовки сущности

Заголовки сущности содержат информацию о теле ресурса, например, его длину содержимого или тип. Сюда относятся заголовки Content-Type и Content-Length.

### 11. Полезные HTTP-заголовки

В данном уроке мы рассмотрим значения некоторых полезных заголовков.

#### Заголовок Host

Заголовок Host содержит в себе имя домена, на который осуществляется запрос.

```
Host: example.com
```

Вместе со стартовой строкой, содержащей URI и заголовком Host, содержащим имя домена, получается URL запрошенной страницы.

```
GET /test/ HTTP/1.1
Host: example.com
```

#### Заголовок Date

Заголовок Date содержит в себе момент времени, в который было создано HTTP-сообщение

```
Date: Wed, 21 Oct 2020 07:28:00 GMT
```

#### Заголовок Last-Modified

Заголовок Last-Modified содержит дату и время, в которую по мнению сервера, запрашиваемый ресурс был изменён. Он используется в качестве средства проверки для определения того, остался ли ресурс неизменным:

```
Last-Modified: Sat, 16 Jan 2020
    21:16:42 GMT
```

#### Заголовок Content-Type

Заголовок Content-Type задаёт тип отданного содержимого и его кодировку

```
Content-Type: text/html; charset=utf-8
```

#### Заголовок Content-Language

Заголовок Content-Language задаёт язык, на котором написан отданный документ

```
Content-Language: ru
```

#### Заголовок Content-Length

Заголовок Content-Length указывает размер отправленного получателю объекта в байтах

```
Content-Length: 10000
```

### 12. Свои HTTP-заголовки

### 13. Тело HTTP-сообщения

### 14. Автоматические HTTP-запросы браузера

### 15. Затраты на HTTP-запросы

### 16. HTTP сообщения в отладчике браузера

## Продвинутое

### 17. HTTP редиректы

### 18. HTTP Referer

### 19. User Agent

### 20. HTTPS

### 21. GET-параметры

### 22. Отправка методом GET

### 23. Отправка форм методом POST

### 24. MIME типы

### 25. AJAX

### 26. Cookie

### 27. Сессии

### 28. API

### 29. REST API
